<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Optimizer - Mercury Analytics</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üìä Portfolio Optimization Tool</h1>
                <p class="subtitle">Advanced portfolio analytics powered by your global market data</p>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel: Configuration -->
            <div class="config-panel">
                <div class="card">
                    <h2>Portfolio Configuration</h2>
                    
                    <!-- Asset Selection -->
                    <div class="form-section">
                        <h3>1. Select Assets</h3>
                        <div class="asset-search">
                            <input type="text" id="assetSearch" placeholder="Search by symbol or name (e.g., AAPL, SPY.US)">
                            <div id="searchResults" class="search-results"></div>
                        </div>
                        <div id="selectedAssets" class="selected-assets">
                            <div class="no-assets">No assets selected. Search and click to add.</div>
                        </div>
                    </div>

                    <!-- Time Period -->
                    <div class="form-section">
                        <h3>2. Time Period</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="startDate">Start Date</label>
                                <input type="date" id="startDate" value="">
                            </div>
                            <div class="form-group">
                                <label for="endDate">End Date</label>
                                <input type="date" id="endDate" value="">
                            </div>
                        </div>
                        <div class="quick-dates">
                            <button class="btn-small" onclick="setDateRange(1)">1 Year</button>
                            <button class="btn-small" onclick="setDateRange(3)">3 Years</button>
                            <button class="btn-small" onclick="setDateRange(5)">5 Years</button>
                            <button class="btn-small" onclick="setDateRange(10)">10 Years</button>
                        </div>
                    </div>

                    <!-- Optimization Method -->
                    <div class="form-section">
                        <h3>3. Optimization Method</h3>
                        <select id="optimizationMethod" class="form-control">
                            <option value="max_sharpe">Maximum Sharpe Ratio</option>
                            <option value="min_volatility">Minimum Volatility</option>
                            <option value="risk_parity">Risk Parity</option>
                            <option value="hrp">Hierarchical Risk Parity (HRP)</option>
                            <option value="max_return">Maximum Return (with vol constraint)</option>
                        </select>
                        
                        <div id="methodDescription" class="method-description">
                            <!-- Dynamic description based on selected method -->
                        </div>

                        <!-- Conditional inputs for specific methods -->
                        <div id="maxReturnInputs" class="conditional-inputs" style="display: none;">
                            <div class="form-group">
                                <label for="maxVolatility">Maximum Volatility (%)</label>
                                <input type="number" id="maxVolatility" value="15" min="1" max="100" step="0.1">
                            </div>
                        </div>
                    </div>

                    <!-- Additional Parameters -->
                    <div class="form-section">
                        <h3>4. Parameters</h3>
                        <div class="form-group">
                            <label for="riskFreeRate">Risk-Free Rate (%)</label>
                            <input type="number" id="riskFreeRate" value="2.0" min="0" max="10" step="0.1">
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="includeFrontier">
                                Calculate Efficient Frontier
                            </label>
                        </div>
                    </div>

                    <!-- Constraints (Advanced) -->
                    <div class="form-section collapsible">
                        <h3 onclick="toggleSection('constraints')">
                            5. Constraints (Optional) 
                            <span class="toggle-icon">‚ñº</span>
                        </h3>
                        <div id="constraints" class="collapsible-content">
                            <div class="form-group">
                                <label for="minWeight">Minimum Weight per Asset (%)</label>
                                <input type="number" id="minWeight" value="0" min="0" max="100" step="0.1">
                            </div>
                            <div class="form-group">
                                <label for="maxWeight">Maximum Weight per Asset (%)</label>
                                <input type="number" id="maxWeight" value="100" min="0" max="100" step="0.1">
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button id="optimizeBtn" class="btn btn-primary" onclick="runOptimization()">
                            üöÄ Optimize Portfolio
                        </button>
                        <button class="btn btn-secondary" onclick="clearForm()">
                            üîÑ Reset
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Results -->
            <div class="results-panel">
                <!-- Initial State -->
                <div id="initialState" class="card">
                    <div class="empty-state">
                        <div class="empty-icon">üìà</div>
                        <h3>Ready to Optimize</h3>
                        <p>Select your assets and parameters, then click "Optimize Portfolio" to see results.</p>
                        <div class="feature-list">
                            <div class="feature-item">‚úì 152,000+ global assets</div>
                            <div class="feature-item">‚úì 109M+ historical price records</div>
                            <div class="feature-item">‚úì Multiple optimization methods</div>
                            <div class="feature-item">‚úì Advanced risk analytics</div>
                        </div>
                    </div>
                </div>

                <!-- Results Display -->
                <div id="resultsDisplay" style="display: none;">
                    <!-- Summary Card -->
                    <div class="card">
                        <h2>Optimization Results</h2>
                        <div id="optimizationSummary" class="optimization-summary">
                            <!-- Dynamically populated -->
                        </div>
                    </div>

                    <!-- Portfolio Metrics -->
                    <div class="card">
                        <h3>Portfolio Metrics</h3>
                        <div id="portfolioMetrics" class="metrics-grid">
                            <!-- Dynamically populated -->
                        </div>
                    </div>

                    <!-- Allocation Chart -->
                    <div class="card">
                        <h3>Asset Allocation</h3>
                        <div class="chart-container">
                            <canvas id="allocationChart"></canvas>
                        </div>
                        <div id="allocationTable" class="allocation-table">
                            <!-- Dynamically populated -->
                        </div>
                    </div>

                    <!-- Efficient Frontier Chart (if calculated) -->
                    <div id="frontierCard" class="card" style="display: none;">
                        <h3>Efficient Frontier</h3>
                        <div class="chart-container">
                            <canvas id="frontierChart"></canvas>
                        </div>
                        <p class="chart-caption">
                            The efficient frontier shows the optimal portfolios offering the highest expected 
                            return for each level of risk. Your optimized portfolio is marked on the frontier.
                        </p>
                    </div>

                    <!-- Export Options -->
                    <div class="card">
                        <h3>Export Results</h3>
                        <div class="export-buttons">
                            <button class="btn btn-small" onclick="exportToCSV()">üìÑ Export to CSV</button>
                            <button class="btn btn-small" onclick="exportToJSON()">üíæ Export to JSON</button>
                            <button class="btn btn-small" onclick="printResults()">üñ®Ô∏è Print Report</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p>Optimizing portfolio...</p>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeErrorModal()">&times;</span>
            <h3>‚ö†Ô∏è Error</h3>
            <p id="errorMessage"></p>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
